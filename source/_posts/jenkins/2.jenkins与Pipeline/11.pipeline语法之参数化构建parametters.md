---
title: pipeline parameters 参数化构建
date: 2019-05-15 08:15:33
tags: [jenkins,Pipeline]
---

parameters是参数的意思，parameters指令提供用户在触发Pipeline时应提供的参数列表。这些用户指定的参数的值通过该params对象可用于Pipeline步骤。

我们很多人听过参数化构建，也可能知道如何在一个jenkins job上，通过UI创建不同的参数，例如有字符串参数，布尔选择参数，下拉多选参数等。这些参数即可以通过UI点击创建，也可以通过pipeline代码去写出来。我们先来看看了解有那些具体参数类型，然后挑选几个，分别用UI和代码方式去实现创建这些参数。

## 1. 通过代码方式创建

### 1. 字符串参数

就是定义一个字符串参数，用户可以在Jenkins UI上输入字符串，常见使用这个参数的场景有，用户名，收件人邮箱，文件网络路径，主机名称的或者url等

字符串参数

就是定义一个字符串参数，用户可以在Jenkins UI上输入字符串，常见使用这个参数的场景有，用户名，收件人邮箱，文件网络路径，主机名称的或者url等

代码举例：
```groovy
Pipeline {
    agent any
    parameters {
        string(name: 'DEPLOY_ENV', defaultValue: 'staging', description: '')
    }
}
```
使用

```bash
echo "$DEPLOY_ENV"
```




### 2. 布尔值参数

就是定义一个布尔类型参数，用户可以在Jenkins UI上选择是还是否，选择是表示代码会执行这部分，如果选择否，会跳过这部分。一般需要使用布尔值的场景有，执行一些特定集成的脚本或则工作，或者事后清除环境，例如清楚Jenkins的workspace这样的动作。

代码举例：
```groovy
Pipeline {
    agent any
    parameters {
        booleanParam(name: 'DEBUG_BUILD', defaultValue: true, description: '')
    }
}
```

### 3. 文本参数

文本（text）的参数就是支持写很多行的字符串，这个变量我好像没有使用过，例如想给发送一段欢迎的消息，你可以采用text的参数。

代码举例：
```groovy
Pipeline {
    agent any
    parameters {
        text(name: 'Welcome_text', defaultValue: 'One\nTwo\nThree\n', description: '')
    }

}
```
上面的\n表示换行，上面写了三行的text。



### 4. 选择参数

选择（choice）的参数就是支持用户从多个选择项中，选择一个值用来表示这个变量的值。工作中常用的场景，有选择服务器类型，选择版本号等。

代码举例：
```groovy
Pipeline {
    agent any
    parameters {
        choice(name: 'ENV_TYPE', choices: ['test', 'dev', 'product'], description: 'test means test env,….')

    }
}
```

### 5. 文件参数

文件（file）参数就是在Jenkins 参数化构建UI上提供一个文件路径的输入框，Jenkins会自动去你提供的网络路径去查找并下载。一般伴随着还有你需要在Pipleline代码中写解析文件。也有这样场景，这个构建job就是把一个war包部署到服务器上特定位置，你可以使用这个文件参数。

```groovy
Pipeline {
    agent any
    parameters {
        file(name: 'FILE', description: 'Some file to upload')
    }

}
```

### 6. 密码参数

密码（password）参数就是在Jenkins 参数化构建UI提供一个暗文密码输入框，例如，我需要在一些linux机器上做自动化操作，需要提供机器的用户名和密码，由于密码涉及安全问题，一般都采用暗文显示，这个时候你就不能用string类型参数，就需要使用password参数类型。

代码举例：
```groovy
Pipeline {
    agent any
    parameters {
        password(name: 'PASSWORD', defaultValue: 'SECRET', description: 'A secret password')

    }
}
```


```groovy
pipeline{

    agent any
    parameters {
        string(name: 'userName', defaultValue: 'Anthony', description: 'please give a name')
        choice(name: 'version', choices: ['1.1', '1.2', '1.3'], description: 'select the version to test')
        booleanParam(name: 'is_boy', defaultValue: true, description: 'you is boy or not')
    }
    stages {
        stage('test') {
            steps{
                script {
                    sh "java -version"
                }
            }
        }
    }
}
```

菜单是Build now，而并不是Build with Parameters，这个是正常，你先点击Build now，先完成第一个构建，Jenkins第二个构建才会显示代码中的三个参数。刷新之后，就可以看到参数化构建这个菜单。

![img](/images/1557369609300.png)

## 2. 通过UI创建



![img](/images/1557368389333.png)
