<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="IOmeter 是一个工作在单系统和集群系统上用来衡量和描述 I/O 子系统的工具。">
<meta property="og:type" content="article">
<meta property="og:title" content="IOmeter测试指导手册">
<meta property="og:url" content="http://gaianote.github.io/2018/07/30/软件测试/IOmeter测试指导手册/index.html">
<meta property="og:site_name" content="李云鹏的个人博客">
<meta property="og:description" content="IOmeter 是一个工作在单系统和集群系统上用来衡量和描述 I/O 子系统的工具。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.1_01.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.1.1_01.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.1.1_02.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.1.2_01.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.1.3.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.1.4_1.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.1.4_2.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.1.5.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.1.6.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.3_1.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.3_2.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.3_3.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.3_4.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/3.3_5.png">
<meta property="og:image" content="http://gaianote.github.io/images/iometer/4.1.png">
<meta property="og:updated_time" content="2019-10-07T13:38:20.408Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IOmeter测试指导手册">
<meta name="twitter:description" content="IOmeter 是一个工作在单系统和集群系统上用来衡量和描述 I/O 子系统的工具。">
<meta name="twitter:image" content="http://gaianote.github.io/images/iometer/3.1_01.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://gaianote.github.io/2018/07/30/软件测试/IOmeter测试指导手册/">





  <title>IOmeter测试指导手册 | 李云鹏的个人博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">李云鹏的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gaianote.github.io/2018/07/30/软件测试/IOmeter测试指导手册/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李云鹏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/rem.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李云鹏的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">IOmeter测试指导手册</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-30T14:10:19+00:00">
                2018-07-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>IOmeter 是一个工作在单系统和集群系统上用来衡量和描述 I/O 子系统的工具。</p>
<a id="more"></a>
<h2 id="IOmeter介绍"><a href="#IOmeter介绍" class="headerlink" title="IOmeter介绍"></a>IOmeter介绍</h2><p>IOmeter 既是工作负载生成器（也就是说，它可以进行输入输出操作，以便增加系统的负荷），它还是一个测量工具（也就是说，它检查并且记录 I/O 操作的性能和对系统的影响）。它可以被配置为模拟任何程序或者基准测试程序的磁盘和网络 I/O 的负载，或者用来产生整个综合的 I/O 负载。它也可以用来产生并测<br>量单系统或者多系统（网络）的负载。</p>
<p>IOmeter 可以被用来测量和描述：</p>
<ul>
<li>磁盘和网络控制器的性能</li>
<li>总线的带宽和时延容量</li>
<li>对于附带驱动器的网络吞吐量</li>
<li>共享总线的性能</li>
<li>系统级别的硬件驱动的性能</li>
<li>系统级别的网络性能</li>
</ul>
<h3 id="组成部分"><a href="#组成部分" class="headerlink" title="组成部分"></a>组成部分</h3><p>IOmeter 包含了两个程序，IOmeter 和 Dynamo.</p>
<ul>
<li><strong>IOmeter</strong> 是控制程序。使用图形用户接口（GUI），你可以配置负载，设置操作参数，启动和停止测试。IOmeteter 告诉Dynamo 去做什么，搜集分析数据，将分析数据输出到文件中。在某一时刻，只能有一个IOmeteter副本运行；典型的情况是运行在服务器上。</li>
<li><strong>Dynamo</strong> 是负载生成器。它没有用户界面。当接收到IOmeteter 发送过来的命令，Dynamo执行相应的I/O 操作并且记录性能信息，然后将数据返回给IOmeteter。它可以有多个副本同时运行；典型的情况是服务器上运行一个副本，每个客户端运行一个副本。Dynamo 是多线程的；每一个副本都可以模拟多客户程序的工作负载。Dynamo中的每一个运行的副本称为一个管理者（Manager）；副本中的一个线程称为工作者（Worker）。</li>
</ul>
<h3 id="版本下载"><a href="#版本下载" class="headerlink" title="版本下载"></a>版本下载</h3><p>IOmeter 是一个开源工具，可以到 <a href="http://www.iometer.org/doc/downloads.html" target="_blank" rel="noopener">http://www.iometer.org/doc/downloads.html</a> 下载，也可以点击<a href="/files/IOmeter1.10.rar">此处</a>下载1.1.0版本备份。截至2018年7月30日，最新版本是 1.1.0。因更新内容很少，最常使用的版本仍为 2006.07.27。</p>
<p>下面我们就以 <code>iometer-2006.07.27.win32.i386-setup.exe</code> 为例进行介绍。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="Windows-下的安装"><a href="#Windows-下的安装" class="headerlink" title="Windows 下的安装"></a>Windows 下的安装</h3><p>Windows 下的安装文件为 <code>iometer-2006.07.27.win32.i386-setup.exe</code>，安装过程如下：</p>
<ul>
<li>双击打开安装文件，点击 next 和同意协议-&gt;选择加入 MS Access 导入导航-&gt;选择安装目录-&gt;<br>安装完成。</li>
</ul>
<h3 id="Linux-下的安装"><a href="#Linux-下的安装" class="headerlink" title="Linux 下的安装"></a>Linux 下的安装</h3><p>Linux 下的安装文件为 <code>iometer-2006_07_27.linux.i386-bin.gz</code>，解压完成后就可以用了：</p>
<ul>
<li>解压该文件：<code>tar xzvf iometer-2006_07_27.linux.i386-bin.gz</code></li>
</ul>
<p>注： Linux 下只有 dynamo 这个 agent，要想控制还得要在 Windows 的一台主机上安装 IOmeteter<br>的 console。</p>
<h2 id="IOmeter使用"><a href="#IOmeter使用" class="headerlink" title="IOmeter使用"></a>IOmeter使用</h2><p><img src="/images/iometer/3.1_01.png" alt="img"></p>
<p>打开 IOmeteter，上面按钮的作用从左到右依次是：</p>
<ul>
<li>打开已有的测试配置文件</li>
<li>保存现在的测试配置文件</li>
<li>新增一个是负载生成器（Dynamo 支持多线程，一般情况下不需要在同一台主机上运行多个Dynamo</li>
<li>新增一个 Disk Worker（后面会介绍通过修改 OutStanding I/Os 数来增大压力，我在跑 IOmeteter 的时候，每台主机只保留一个 Disk Worker） ；</li>
<li>在选定的主机下，点击该按钮可以增加一个 Network Worker</li>
<li>选中某一个 Disk Worker 或 Network Worker，让后点击该按钮，会复制出一个完全一样的 Worker</li>
<li>开始测试；</li>
<li>停止当前测试并保存结果；</li>
<li>中断所有测试；</li>
<li>将 Workers 复位（reset 掉当前的配置，相当于把 IOmeteter 关了再重新打开）；</li>
<li>删除,可以方便地删除 Topology 窗体下的 Manager、Worker</li>
<li>退出软件；</li>
<li>关于 IOmeteter，显示版本和开源许可信息。</li>
</ul>
<h3 id="在-Windows-主机打开-IOmeter"><a href="#在-Windows-主机打开-IOmeter" class="headerlink" title="在 Windows 主机打开 IOmeter"></a>在 Windows 主机打开 IOmeter</h3><p>Console 如下图所示，默认会在 Topology 里面出现本机以及几个 Disk Worker（软件会根据主机 CPU 个数来决定增加几个 Disk Worker），在这里，点选中 Worker2，然后点击 <strong>删除按钮</strong>，只保留一个 Worker。</p>
<p><img src="/images/iometer/3.1.1_01.png" alt="img"></p>
<p>大家还会注意到，运行该工具的同时，任务栏多了一个 Dos 窗口，没错，根据第一章介绍的，这个 Dos 窗口才是真正的负载生成器，而上面的图形窗口只是一个控制台。</p>
<p>可以做一个实验，点击 <strong>新增负载生成器按钮</strong>增加一个 Manager，我们发现在 Topology 里面多了一台主机，任务栏也多了一个负载生成器的 Dos 窗口。</p>
<p><img src="/images/iometer/3.1.1_02.png" alt="img"></p>
<h3 id="Disk-Target-界面及参数介绍"><a href="#Disk-Target-界面及参数介绍" class="headerlink" title="Disk Target 界面及参数介绍"></a>Disk Target 界面及参数介绍</h3><p>如下图，框 1 中指的是 Disk Worker 1 会在用户盘 D 上进行 IO 测试；</p>
<p><img src="/images/iometer/3.1.2_01.png" alt="img"></p>
<p>框 2 中“Maximum Disk Size”单位是 Sectors(扇区)，意思是说 Worker 1 会在 D 盘占用多少个扇区进行压力测试。 默认填 0，会将 D 盘的剩余空间全用完。（Windows 系统每个扇区的大小是 512Byte，所以这里填 20,000,000 就是指 Worker 1 会占用 D 盘 10GB 的空间，另外在做 FCSAN/IPSAN 磁盘测试时设置的大小推荐大于 SAN 设备缓存的 2 倍，太小的话 IOmeteter 只跑在缓存上，跑出来的性能会偏高不准确。但是从里一个方面来说，如果我们想让最终的结果看起来好看，那么我们可以将该参数设置的小一点，根据测试目的自己把握）；“Starting Disk Sector”即 Worker1 从哪个扇区开始写它的 iobw.tst 测试文件，这里保持默认的 0即可。</p>
<p>框 3 中“# of Outstanding I/Os”指的是 Worker 1 在 D 盘上同时会开多少个异步的 IO 操作，在主机的CPU、内存能力够强时，并发数越多最终跑出来的结果会越准确，默认的是 1 个。 具体设置为多少比较好，我们可以实际试一下：先跑 1 个，看看 Result 是多少，5 个时 Result 是多少，10 个、20 个、50 个、100 个、120 个…… 在 CPU 内存承受范围内，找到一个最合适的值。</p>
<p>框 4 中“Test Connection Rate”指的是 Worker 1 以什么样的操作频率频率打开、关闭 D 盘。 默认不勾选的意思是，所有的连接都是 open 状态，直到测试停止。这里我们保持默认即可。</p>
<h3 id="Network-Targets-界面及参数介绍"><a href="#Network-Targets-界面及参数介绍" class="headerlink" title="Network Targets 界面及参数介绍"></a>Network Targets 界面及参数介绍</h3><p>下图是在用 IOmeteter 跑网络压力时截的图，这里需要两台主机对跑网络，本例中不涉及，先不去管它，后面章节会详细讲到。</p>
<p><img src="/images/iometer/3.1.3.png" alt="img"></p>
<h3 id="Access-Specifications-界面及参数介绍"><a href="#Access-Specifications-界面及参数介绍" class="headerlink" title="Access Specifications 界面及参数介绍"></a>Access Specifications 界面及参数介绍</h3><p>Access Specification 是 IOmeteter 工具根据什么样的规格来跑 IO 测试。这里我们每次只添加一个规格，如下图。（如果添加多个规格的话，IOmeteter 会按照从上到下的顺序依次跑每个规格，直到测试停止，用来模拟复杂场景）</p>
<p><img src="/images/iometer/3.1.4_1.png" alt="img"></p>
<p>如上图，Access Specification，框 1 中是已经定义好的规格。框 2 中可以对 Global Access Specification 做相应的新建、编辑、复制并编辑、删除操作。</p>
<p>框 3 中是已经添加的 Worker1 里面的线程需要在 Target Disk 里面跑的压力的规格。一般我们只跑一个就好了。 当然我们也可以 Add 多个规格来模拟复杂的应用，假设我们 Add 了 4 个规格，IOmeteter 会依次从上到下的顺序来执行相应的读写操作。</p>
<p>规格的具体参数是什么，又有什么意义和影响呢？ 我们用下面的截图说明，新建一个规格，并分析里面的参数：</p>
<p><img src="/images/iometer/3.1.4_2.png" alt="img"></p>
<p>框 1 “Name”，需要给新建的规格定义一个易懂的名字，比如用参数，或者“Web server workload”等形象的名字；</p>
<p>框 2 “Default Assignment”，我们保持默认的 none 就好了（这一项的意思是，例如你设置某个规格的“Default Assignment”为 Disk Workers 就会发现,每当你新增一个 Disk Worker 时，这个规格会被默认添加到该 Disk Worker 的“Assigned Access Specifications”里面； 同理我们把某个规格的“Default Assignment”设置为 All Workers，那么每当我们新增加一个 Worker 时，这个规格都会被默认加到该 Worker 的“AssignedAccess Specifications”里面。该选项对测试结果没有任何影响，可以不设置，保持默认。）</p>
<p>框 3 可以看到该规格的配置信息，这里我们只跑一个规格，所以不用管它。</p>
<p>框 4 每次 IO 的大小，这个值越小则跑出来的结果里面的 IOPS 就会越大，带宽就会越小。相反，这个值越大，跑出来的结果里面的 IOPS 就会越小，带宽就会越大。只能填写 512Byte 的整数倍，否则跑的时候会报错。</p>
<p>框 5，Percent of Access Specification（该规格在所有规格中占用的连接百分比），由于这里我们只跑一个规格，所以保持默认 100%就可以了。</p>
<p>框 6，读写比例，这个参数对结果影响也很大，因为读的性能是比写的性能好很多的</p>
<p>框 7，随即/顺序读写的百分比，这个参数对结果影响也很大，因为顺序读写，比随机读写的性能好很多。</p>
<p>框 8，可以模拟定量的 IOPS，比如在 Delay 里面填 1000（单位毫秒，1000 毫秒即 1 秒钟），然后在 Burst Length 里面填 10. 意思就是在一秒钟会发生 10 个 IOPS。</p>
<p>框 9、10，保持默认即可。</p>
<p>在测试中，我们通过改变三个参数，即上面黑体部分的块大小、读写百分比、随机顺序百分比来模拟不同场景的应用。 如果我们想得到 IOPS 的极限，那么我们可以用“512Byte; 100%Read; 0%random”规格来跑。 如果我们想得到带宽的极限，那么我们可以用“32KB（可以用 64K、128K、1024K 或者更大，这需要调测几次看哪个值能够得到带宽最大值）; 100%Read; 0%random”的规格来跑。</p>
<blockquote>
<p>传输数据块大小在应用服务器类型测试为 4KB，数据库服务器类型测试为 8KB；读写百分比在应用服务器类型测试为读 100%，数据库服务器类型测试根据实际情况来判断，如纯查询的数据库读 100%，一个典型的业务系统的数据库系统，按照默认的 67%读即可；随机/连续存取百分比在应用服务器类型测试为 100%，数据库服务器类型测试为 100%；（测试人员可根据实际情况修改此处数值，典型的 OLAP 环境：选择顺序的大 IO，测试存储所能支持的最大吞吐量以及响应时间；典型的 OLTP 环境：选择随机的小 IO，测试存储所能支持的最大 IOPS 以及响应时间）。</p>
</blockquote>
<h3 id="Test-Setup-界面"><a href="#Test-Setup-界面" class="headerlink" title="Test Setup 界面"></a>Test Setup 界面</h3><p>可以设置测试跑多长时间，即“Run Time”。</p>
<p>设置“Ramp Time”的目的是保证结果更准确，因为 IO 测试开始的前几秒钟得出的数据与实际数据误差较大，例如我们这里设置“15”的意思是，真正的 IO 测试开始 15 秒钟后，才会在“Result Display”界面中记录测试结果。</p>
<p>其它设置保持默认。</p>
<p><img src="/images/iometer/3.1.5.png" alt="img"></p>
<h3 id="Result-Display-界面"><a href="#Result-Display-界面" class="headerlink" title="Result Display 界面"></a>Result Display 界面</h3><p><strong>Update Frequency</strong>，指下面的蓝色条的结果更新的频率，默认是无穷大，如果不点击鼠标修改的话会一直看不到更新的结果。当进行一项高负载测试时，不建议设置更新频率过小，否则会影响系统性能。</p>
<p><strong>Results Since</strong>，选择上面的 Start of Test 是说从记录结果开始一直到现在的平均结果。 选择下面的 Last Update 意思是，只显示最近 5 秒钟的性能结果。</p>
<p>这个界面可以通过点击鼠标，来选择显示不同的参数，动手试试吧。</p>
<p><img src="/images/iometer/3.1.6.png" alt="img"></p>
<h3 id="Windows-下单机跑-IOmeteter"><a href="#Windows-下单机跑-IOmeteter" class="headerlink" title="Windows 下单机跑 IOmeteter"></a>Windows 下单机跑 IOmeteter</h3><p>熟悉了上面讲的参数的意思后，Windows 上单机跑 IOmeteter 就很简单了。<br>将参数设置好，点击 <strong>start Tests</strong>，根据提示选择日志日志保存的位置和文件名 xxx.csv 就 OK 了，现在就在你的 PC 机上练练手吧。（PC 机性能有限，建议将<code># of Outstandings</code> 设置在 10 以下，以免 PC 机卡死）</p>
<h3 id="Windows-下用-IOmeteter-跑网络压力"><a href="#Windows-下用-IOmeteter-跑网络压力" class="headerlink" title="Windows 下用 IOmeteter 跑网络压力"></a>Windows 下用 IOmeteter 跑网络压力</h3><p>有两台虚拟机，VM54 和 VM58，以这两台 VM 为例介绍如何用 IOmeteter 工具跑网络压力。</p>
<p>在 VM54 打开 IOmeter 界面作为 Console 端，如下图在 VM58 打开 CMD 进入 IOmeteter 的安装目录路径下，然后输入命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dynamo –i vm54(或者 VM54 的 IP 地址，-i 是指定 console 端) –m VM58（或 VM58 的IP，-m 是指定 Worker）</span><br></pre></td></tr></table></figure>
<p>注意，要先打开 Console 端再在 client 端运行该命令，否则 Console 找不到 client</p>
<p>这样，如图在 VM54 的控制台上出现 VM58:</p>
<p><img src="/images/iometer/3.3_1.png" alt="img"></p>
<p>由于这里只演示跑网络压力，所以将 Disk Worker move 掉。</p>
<p>在 VM54 增加 8 个 Network 的 Worker，并添加 VM58 为 Targets，如下图</p>
<p><img src="/images/iometer/3.3_2.png" alt="img"></p>
<p>增加如下规格的连接</p>
<p><img src="/images/iometer/3.3_3.png" alt="img"></p>
<p>开始 run，如下图，网络利用达到了 100%</p>
<p><img src="/images/iometer/3.3_4.png" alt="img"></p>
<p>测试结果</p>
<p><img src="/images/iometer/3.3_5.png" alt="img"></p>
<h2 id="自动化脚本"><a href="#自动化脚本" class="headerlink" title="自动化脚本"></a>自动化脚本</h2><h3 id="根据帮助文档查看-IOmeter-参数"><a href="#根据帮助文档查看-IOmeter-参数" class="headerlink" title="根据帮助文档查看 IOmeter 参数"></a>根据帮助文档查看 IOmeter 参数</h3><p>打开 cmd，在 IOmeteter 目录下，输入命令 iometer ？ 得到以下帮助文档</p>
<p><img src="/images/iometer/4.1.png" alt="img"></p>
<h3 id="自动化测试脚本"><a href="#自动化测试脚本" class="headerlink" title="自动化测试脚本"></a>自动化测试脚本</h3><p>如果有多台机器要跑相同的 IOmeteter 测试，就可以先在一台机器上将参数设置好，并保存为配置文件xxx.icf。 我们把这个配置文件拷贝到每台机器的 IOmeteter 安装目录下，同时日志也放到安装目录下,创建如下脚本，并保存为.bat 文件，双击就可以运行了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &quot;\Program Files\IOmeteter.org\IOmeteter 2006.07.27&quot;</span><br><span class="line">iometer iometer_config.icf iometer_result.csv</span><br></pre></td></tr></table></figure>
<h2 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h2><p>本章主要讲述在结果显示页签中各个性能指标的含义。</p>
<h3 id="Opretions-per-second"><a href="#Opretions-per-second" class="headerlink" title="Opretions per second"></a>Opretions per second</h3><ul>
<li><strong>Total I/Os per Second(IOPS)</strong>：每秒 I/O 次数，包含读 I/O 和写 I/O。对于磁盘来说，一次磁头的连续<br>读或者连续写就是一次 I/O。</li>
<li><strong>Read I/Os per Second</strong>：每秒读 I/O 次数。</li>
<li><strong>Write I/Os per Second</strong>：每秒写 I/O 次数。</li>
<li><strong>Transaction per Second</strong>：每秒事务处理数。当在存取规则中设置 Reply Size 为”no reply”时，Transaction per Second=IOPS，即事务只包含发送数据块；当在存取规则中设置了 Reply Size 不为 0 时，Transaction per Second 将发送和接收数据块作为一个事务。</li>
<li><strong>Connections per Second</strong>：每秒连接数</li>
</ul>
<h3 id="Megabytes-per-second"><a href="#Megabytes-per-second" class="headerlink" title="Megabytes per second"></a>Megabytes per second</h3><ul>
<li><strong>Total MBs per Second</strong>：每秒数据传输量，也就是常说的吞吐量，包含读取和写入。<code>Total MBs per Second=IOPS*传输数据块大小= Transaction per Second*（传输数据块+接收数据块）</code></li>
<li><strong>Read MBs per Second</strong>：每秒读取数据量。</li>
<li><strong>Write MBs per Second</strong>：每秒写入数据量。</li>
</ul>
<h3 id="Avarange-latency"><a href="#Avarange-latency" class="headerlink" title="Avarange latency"></a>Avarange latency</h3><ul>
<li><strong>Average I/O Response Time(ms)</strong>：平均 I/O 响应时间。</li>
<li><strong>Avg.Read Response Time(ms)</strong>：平均读 I/O 响应时间。</li>
<li><strong>Avg.Write Response Time(ms)</strong>：平均写 I/O 响应时间。</li>
<li><strong>Avg. Transaction Time(ms)</strong>：平均事务处理时间。</li>
<li><strong>Avg. Connections Time(ms)</strong>：平均连接时间。</li>
</ul>
<h3 id="Maximum-latency"><a href="#Maximum-latency" class="headerlink" title="Maximum latency"></a>Maximum latency</h3><ul>
<li><strong>Maximum I/O Response Time(ms)</strong>：最大 I/O 响应时间。</li>
<li><strong>Max.Read Response Time(ms)</strong>：最大读 I/O 响应时间。</li>
<li><strong>Max.Write Response Time(ms)</strong>：最大写 I/O 响应时间。</li>
<li><strong>Max. Transaction Time(ms)</strong>：最大事务处理时间。</li>
<li><strong>Max. Connections Time(ms)</strong>：最大连接时间。</li>
</ul>
<h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><ul>
<li><strong>%CPU Utilization（total）</strong>：CPU 占用率。</li>
<li><strong>%User Time</strong>：非内核级应用程序占用时间。</li>
<li><strong>%Privileged Time</strong>：CPU 内核程序占用时间，是在特权模式下处理线程执行代码所花时间的百分比</li>
<li><strong>%DPC Time</strong>：处理器在网络处理上消耗的时间。%DPC Time 是%Privileged Time 的一部分。</li>
<li><strong>%Interrupt Time</strong>：中断时间是在采样间隔期间接收和处理硬件中断处理器花费的时间百分比，如系统时钟，鼠标，磁盘驱动器，数据通信线路，网络接口卡和其它外围设备。</li>
<li><strong>Interrupts per Second</strong>：每秒中断数。</li>
<li><strong>CPU Effectiveness</strong>：CPU 效率的一个表征：将 IOPS 除以%CPU Utilization 即可得到。</li>
</ul>
<h3 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h3><ul>
<li><strong>Network Packets per Second</strong>：每秒网络数据包发送/接收数。</li>
<li><strong>Packets Errors</strong>：错误包个数。</li>
<li><strong>TCP Segments Retrans.per Sec</strong>：TCP 数据段每秒返回数。</li>
</ul>
<h3 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h3><ul>
<li><strong>Total Error Count</strong>：总错误数。</li>
<li><strong>Read Error Count</strong>：读取错误数。</li>
<li><strong>Write Error Count</strong>：写入错误数。</li>
</ul>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="/files/IOmeter测试指导手册.pdf">IOmeter测试指导手册</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/25/前端/javascript-es6入门/" rel="next" title="javascript_es6入门">
                <i class="fa fa-chevron-left"></i> javascript_es6入门
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/30/linux/centos使用yum安装python3以及pip3/" rel="prev" title="centos使用yum安装python3以及pip3">
                centos使用yum安装python3以及pip3 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div id="gitalk-container"></div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/rem.png" alt="李云鹏">
            
              <p class="site-author-name" itemprop="name">李云鹏</p>
              <p class="site-description motion-element" itemprop="description">萍水相逢也是前世之缘</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">219</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#IOmeter介绍"><span class="nav-number">1.</span> <span class="nav-text">IOmeter介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#组成部分"><span class="nav-number">1.1.</span> <span class="nav-text">组成部分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#版本下载"><span class="nav-number">1.2.</span> <span class="nav-text">版本下载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-number">2.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows-下的安装"><span class="nav-number">2.1.</span> <span class="nav-text">Windows 下的安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux-下的安装"><span class="nav-number">2.2.</span> <span class="nav-text">Linux 下的安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IOmeter使用"><span class="nav-number">3.</span> <span class="nav-text">IOmeter使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#在-Windows-主机打开-IOmeter"><span class="nav-number">3.1.</span> <span class="nav-text">在 Windows 主机打开 IOmeter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Disk-Target-界面及参数介绍"><span class="nav-number">3.2.</span> <span class="nav-text">Disk Target 界面及参数介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-Targets-界面及参数介绍"><span class="nav-number">3.3.</span> <span class="nav-text">Network Targets 界面及参数介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Specifications-界面及参数介绍"><span class="nav-number">3.4.</span> <span class="nav-text">Access Specifications 界面及参数介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Test-Setup-界面"><span class="nav-number">3.5.</span> <span class="nav-text">Test Setup 界面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Result-Display-界面"><span class="nav-number">3.6.</span> <span class="nav-text">Result Display 界面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows-下单机跑-IOmeteter"><span class="nav-number">3.7.</span> <span class="nav-text">Windows 下单机跑 IOmeteter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows-下用-IOmeteter-跑网络压力"><span class="nav-number">3.8.</span> <span class="nav-text">Windows 下用 IOmeteter 跑网络压力</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自动化脚本"><span class="nav-number">4.</span> <span class="nav-text">自动化脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#根据帮助文档查看-IOmeter-参数"><span class="nav-number">4.1.</span> <span class="nav-text">根据帮助文档查看 IOmeter 参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自动化测试脚本"><span class="nav-number">4.2.</span> <span class="nav-text">自动化测试脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#性能指标"><span class="nav-number">5.</span> <span class="nav-text">性能指标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Opretions-per-second"><span class="nav-number">5.1.</span> <span class="nav-text">Opretions per second</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Megabytes-per-second"><span class="nav-number">5.2.</span> <span class="nav-text">Megabytes per second</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Avarange-latency"><span class="nav-number">5.3.</span> <span class="nav-text">Avarange latency</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Maximum-latency"><span class="nav-number">5.4.</span> <span class="nav-text">Maximum latency</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU"><span class="nav-number">5.5.</span> <span class="nav-text">CPU</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Network"><span class="nav-number">5.6.</span> <span class="nav-text">Network</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Errors"><span class="nav-number">5.7.</span> <span class="nav-text">Errors</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文档"><span class="nav-number">6.</span> <span class="nav-text">参考文档</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李云鹏</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    //这两句是调用作者的css和js文件
    <script src="/js/src/md5.min.js"></script>
    <script type="text/javascript">
        var gitalk = new Gitalk({       //这里面的参数我们会在另一个文件中配置
            clientID:  '5a3c5360539711069cd5',
            clientSecret: '2c5c5bde68afec70aecc213b1d0e42bc929f3583',
            repo: 'gaianote.github.io',
            owner: 'gaianote',
            admin: 'gaianote',
            id: md5(location.pathname),
            distractionFreeMode: '',
          })
          gitalk.render('gitalk-container')
    </script>

  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
